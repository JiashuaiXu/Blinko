# 功能需求文档

本文档详细描述 Blinko / 明眸 的所有功能模块和交互流程。

---

## 1. 定时提醒模块

### 1.1 功能描述
基于 20-20-20 护眼法则，定时提醒用户休息。

### 1.2 功能特性
- **默认间隔**：每 20 分钟提醒一次
- **提醒内容**：提示用户看 20 英尺外 20 秒
- **提醒方式**：
  - 系统托盘图标闪烁
  - 桌面通知弹窗
  - 可选声音提醒（轻柔"滴"声或鸟鸣）

### 1.3 交互流程
1. 用户启动应用后，定时器开始计时
2. 20 分钟后，触发提醒
3. 显示提醒弹窗，包含：
   - Blinko 动画/图标
   - 提醒文字："该休息了！看看远方 20 秒吧"
   - 操作按钮：
     - "开始休息"（启动 20 秒倒计时）
     - "跳过本次"
     - "延迟 5 分钟"
4. 用户选择操作后，记录到统计系统
5. 定时器重置，继续计时

### 1.4 配置选项
- 提醒间隔（10/15/20/30/45/60 分钟）
- 提醒方式（弹窗/通知/声音）
- 声音类型（系统默认/轻柔/鸟鸣/静音）
- 是否启用定时提醒（开关）

---

## 2. 眨眼激励模块

### 2.1 功能描述
通过摄像头检测用户眨眼频率，长时间未眨眼时提醒。

### 2.2 功能特性
- **检测频率**：每 5 秒检测一次（可配置）
- **检测阈值**：连续 30 秒未检测到眨眼（可配置）
- **提醒方式**：桌面通知 + Blinko 动画
- **隐私保护**：所有图像处理在本地，不保存图像

### 2.3 交互流程
1. 用户启用眨眼检测功能
2. 首次使用需授权摄像头权限
3. 摄像头启动，开始实时检测
4. 检测到眨眼 → 更新统计，重置计时器
5. 连续 30 秒未检测到眨眼：
   - 触发提醒："眨眨眼吧！让眼睛放松一下"
   - 显示 Blinko 眨眼动画
   - 记录本次提醒
6. 用户眨眼后，检测恢复正常

### 2.4 技术实现
- **检测算法**：MediaPipe Face Mesh（轻量级）
- **检测精度**：80% 以上准确率（可接受误报）
- **性能要求**：CPU 占用 < 10%，延迟 < 500ms

### 2.5 配置选项
- 启用/禁用眨眼检测
- 检测间隔（3/5/10 秒）
- 提醒阈值（15/30/45/60 秒）
- 摄像头设备选择（如有多个）

---

## 3. 坐姿检测模块

### 3.1 功能描述
通过摄像头检测用户坐姿，发现异常时提醒。

### 3.2 功能特性
- **检测类型**：
  - 趴桌（头部过低）
  - 歪斜（头部/肩部倾斜）
  - 距离过近（头部离屏幕太近）
- **检测频率**：每 2 秒检测一次
- **提醒方式**：桌面通知（不打断工作）

### 3.3 交互流程
1. 用户启用坐姿检测功能
2. 首次使用需授权摄像头权限
3. 摄像头启动，开始实时检测
4. 检测到异常坐姿：
   - 立即触发提醒（不等待持续时长）
   - 显示提示："坐姿提醒：请保持正确姿势"
   - 可选：显示参考坐姿示意图
5. 检测到坐姿恢复正常后，停止提醒
6. 记录异常时长到统计系统

### 3.4 技术实现
- **检测算法**：MediaPipe Pose / Face Mesh（关键点检测）
- **判断逻辑**：
  - 头部位置 vs 肩部位置（相对高度）
  - 头部中心点 vs 肩部中心点（左右偏移）
  - 头部到屏幕的距离（估算）
- **性能要求**：CPU 占用 < 15%，延迟 < 2 秒

### 3.5 配置选项
- 启用/禁用坐姿检测
- 检测灵敏度（低/中/高）
- 提醒频率限制（避免频繁打扰）
- 是否显示参考示意图

---

## 4. 系统托盘模块

### 4.1 功能描述
应用常驻系统托盘，提供快速访问和状态显示。

### 4.2 功能特性
- **托盘图标**：显示应用状态
  - 🟢 正常（绿色）
  - 🟡 久坐（黄色，连续工作 > 1 小时）
  - 🔴 需休息（红色，超过提醒时间未休息）
- **右键菜单**：
  - 打开主面板
  - 今日统计
  - 设置
  - 暂停/恢复提醒
  - 退出
- **左键点击**：打开主面板

### 4.3 交互流程
1. 应用启动后自动最小化到托盘
2. 图标根据当前状态实时更新颜色
3. 用户点击图标 → 打开主面板
4. 用户右键点击 → 显示菜单
5. 用户选择菜单项 → 执行对应操作

### 4.4 状态逻辑
- **正常（绿色）**：
  - 定时提醒未到时间
  - 眨眼/坐姿检测正常
  - 未超过 1 小时连续工作
- **久坐（黄色）**：
  - 连续工作时间 > 1 小时
  - 但未超过提醒阈值
- **需休息（红色）**：
  - 定时提醒已触发但未响应
  - 或超过 2 小时未休息

---

## 5. 数据统计模块

### 5.1 功能描述
记录和展示用户的健康习惯数据。

### 5.2 数据指标
- **今日数据**：
  - 定时提醒次数
  - 实际休息次数
  - 平均坐姿时长
  - 眨眼提醒次数
  - 坐姿提醒次数
- **历史趋势**：
  - 7 天/30 天提醒趋势图
  - 坐姿时长趋势图
  - 眨眼频率趋势图

### 5.3 界面设计
- **仪表盘页面**：
  - 今日概览卡片
  - 趋势图表（使用轻量级图表库）
  - 成就徽章（可选）
- **数据存储**：
  - 本地 SQLite 数据库
  - 数据保留 90 天（可配置）

### 5.4 交互流程
1. 用户打开主面板
2. 默认显示"今日"标签页
3. 显示今日数据卡片和简单图表
4. 切换到"历史"标签页
5. 显示趋势图表和详细数据
6. 可导出数据为 CSV（可选）

---

## 6. 设置模块

### 6.1 功能描述
用户可配置应用的各种参数。

### 6.2 设置分类
- **提醒设置**：
  - 定时提醒间隔
  - 提醒方式（弹窗/通知/声音）
  - 声音类型
- **检测设置**：
  - 眨眼检测开关
  - 眨眼检测参数
  - 坐姿检测开关
  - 坐姿检测灵敏度
- **界面设置**：
  - 语言选择（中文/英文）
  - 主题（亮色/暗色，可选）
  - 是否开机自启
- **数据设置**：
  - 数据保留天数
  - 是否允许数据导出

### 6.3 交互流程
1. 用户打开设置页面
2. 按分类显示设置项
3. 用户修改设置
4. 实时保存到本地配置文件
5. 部分设置需要重启应用生效（提示用户）

---

## 7. 多语言支持

### 7.1 支持语言
- 中文（简体，默认）
- 英文

### 7.2 实现方式
- 使用 i18n 框架（如 react-i18next）
- 语言文件存储在 `src/locales/`
- 用户可在设置中切换语言
- 切换后立即生效（无需重启）

### 7.3 文案要求
- 所有用户可见文案需支持双语
- 技术术语保持一致性
- 文案风格符合品牌定位（内敛中式 + 科技萌）

---

## 8. 隐私保护

### 8.1 隐私原则
- **本地处理**：所有图像处理在本地完成
- **不存储图像**：摄像头数据仅用于实时检测，不保存
- **不上传数据**：所有数据存储在本地，不上传到服务器
- **透明告知**：首次使用摄像头时明确告知用途

### 8.2 权限管理
- 摄像头权限：仅在启用检测功能时请求
- 用户可随时在设置中禁用摄像头
- 禁用后立即停止检测和数据处理

### 8.3 数据存储
- 统计数据存储在本地 SQLite 数据库
- 配置文件存储在本地 JSON 文件
- 所有数据用户可随时查看和删除

